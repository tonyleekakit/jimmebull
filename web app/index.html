<!doctype html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>訓練監控</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="topbar">
      <nav class="tabs" aria-label="主要">
        <button class="tab is-active" type="button" data-tab="plan">訓練監控</button>
        <button class="tab" type="button" data-tab="howto">如何使用</button>
        <button class="tab" type="button" data-tab="pace">配速計算機</button>
      </nav>
      <a class="brand" href="#plan" aria-label="返回訓練監控">
        <img class="brand__img" src="./assets/logo.png" alt="Logo" onerror="this.style.display='none';" />
      </a>
      <button id="authBtn" class="btn authBtn" type="button">登入</button>
    </header>

    <main class="page">
      <section id="tab-plan" class="tabPanel is-active" aria-label="訓練監控">
        <div class="planActions">
          <div class="planActions__right">
            <label class="annualVolumeField" aria-label="年總訓練量">
              <span class="muted">年總訓練量（小時）</span>
              <input
                id="annualVolumeInput"
                class="input"
                type="number"
                inputmode="decimal"
                step="1"
                min="0"
                placeholder="例如 320"
                aria-label="年總訓練量（小時）"
              />
            </label>
            <button id="annualVolumeApplyBtn" class="btn" type="button">套用</button>
            <button id="annualVolumeClearBtn" class="btn" type="button">清除</button>
            <button id="autoFillWeekBtn" class="btn" type="button">自動填充本週課表</button>
            <button id="autoFillAllBtn" class="btn" type="button">自動填充52週課表</button>
            <button id="raceInputBtn" class="btn btn--primary" type="button">輸入比賽</button>
            <button id="exportPdfBtn" class="btn" type="button">匯出 PDF</button>
            <button id="resetBtn" class="btn" type="button">重設</button>
          </div>
        </div>

        <div id="plannedVolume52" class="calendarSummary" aria-label="52 週計劃訓練量"></div>

        <div id="calendarShell" class="calendarShell" aria-label="訓練表">
          <div class="calendarSizer" aria-label="表格大小">
            <button id="calSizeUp" class="iconBtn" type="button" aria-label="放大" title="放大">+</button>
            <input id="calSizeRange" class="calSizeRange" type="range" min="70" max="140" step="5" value="100" aria-label="表格大小" />
            <button id="calSizeDown" class="iconBtn" type="button" aria-label="縮小" title="縮小">−</button>
          </div>
          <div class="calendarWrap">
            <div id="calendar" class="calendar" role="grid" aria-label="52 週訓練表"></div>
          </div>
        </div>

        <section class="weekSection" aria-label="每週詳情">
          <div class="weekHeader">
            <div class="weekPicker">
              <span class="muted">選擇週</span>
              <select id="weekSelect" aria-label="選擇週"></select>
            </div>
            <div id="weekMeta" class="muted"></div>
          </div>
          <div id="weekDays" class="weekDays" aria-label="Day 卡片"></div>
        </section>

        <div id="chartsRoot" class="chartsGrid" aria-label="圖表內容"></div>
      </section>

      <section id="tab-howto" class="tabPanel" aria-label="如何使用">
        <div class="howtoIntro calendarSummary" aria-label="如何使用說明">
          <div class="howtoIntro__title">如何使用「訓練監控」</div>
          <div class="muted">下方每個步驟配合截圖作教學配圖，逐步講解「訓練監控」頁面功能。</div>
        </div>

        <div class="howtoGrid" aria-label="教學步驟">
          <div class="chartCard howtoStep" aria-label="設定起始日期">
            <div class="chartCard__title">1. 設定起始日期（第 1 週星期一）</div>
            <div class="muted">在表格「星期一」列的第 1 格，選擇起始星期一；系統會自動更新後續 52 週日期。</div>
            <div class="howtoShot" data-howto-shot-key="startDate">
              <div class="howtoShot__frame">
                <img class="howtoShot__img" alt="起始日期設定截圖" data-static-src="./assets/howto/step-1.png" />
                <div class="howtoShot__placeholder">截圖：起始日期設定</div>
              </div>
            </div>
          </div>

          <div class="chartCard howtoStep" aria-label="設定年總訓練量">
            <div class="chartCard__title">2. 設定年總訓練量（可選）</div>
            <div class="muted">在頁面上方輸入「年總訓練量（小時）」並按「套用」，上方會顯示「已分配/差額」。</div>
            <div class="howtoShot" data-howto-shot-key="annualVolume">
              <div class="howtoShot__frame">
                <img class="howtoShot__img" alt="年總訓練量截圖" data-static-src="./assets/howto/step-2.png" />
                <div class="howtoShot__placeholder">截圖：年總訓練量設定</div>
              </div>
            </div>
          </div>

          <div class="chartCard howtoStep" aria-label="設定週期與比賽">
            <div class="chartCard__title">3. 設定週期與比賽</div>
            <div class="muted">用「週期」列設定基礎/建立/巔峰/減量/過渡；按「輸入比賽」加入比賽後，系統會自動更新相關週的週期/強度安排。</div>
            <div class="howtoShot" data-howto-shot-key="blocksAndRaces">
              <div class="howtoShot__frame">
                <img class="howtoShot__img" alt="週期與比賽截圖" data-static-src="./assets/howto/step-3.png" />
                <div class="howtoShot__placeholder">截圖：週期與比賽</div>
              </div>
            </div>
          </div>

          <div class="chartCard howtoStep" aria-label="設定計劃訓練量">
            <div class="chartCard__title">4. 設定每週「計劃訓練量（小時）」</div>
            <div class="muted">點擊表格「計劃訓練量（小時）」欄可開啟視窗：第 1–4 週可直接輸入；第 5–52 週預設用公式（過去四週平均 × 參數），參數會跟隨週期/比賽週而自動變動。</div>
            <div class="howtoShot" data-howto-shot-key="plannedVolumeModal">
              <div class="howtoShot__frame">
                <img class="howtoShot__img" alt="計劃訓練量視窗截圖" data-static-src="./assets/howto/step-4.png" />
                <div class="howtoShot__placeholder">截圖：計劃訓練量視窗</div>
              </div>
            </div>
          </div>

          <div class="chartCard howtoStep" aria-label="自動填充課表">
            <div class="chartCard__title">5. 自動填充每日課表（Day 卡片）</div>
            <div class="muted">設定完訓練量後，按「自動填充本週課表」會用當週訓練量/週期/比賽生成 7 天內容；按「自動填充 52 週課表」會覆蓋所有已有 Day 卡片內容。</div>
            <div class="howtoShot" data-howto-shot-key="autoFill">
              <div class="howtoShot__frame">
                <img class="howtoShot__img" alt="自動填充截圖" data-static-src="./assets/howto/step-5.png" />
                <div class="howtoShot__placeholder">截圖：自動填充課表</div>
              </div>
            </div>
          </div>

          <div class="chartCard howtoStep" aria-label="查看風險指標">
            <div class="chartCard__title">6. 查看風險指標：單調度 / ACWR</div>
            <div class="muted">表格下方的「單調度」與「ACWR」會根據 Day 卡片內容計算；當 ACWR &gt; 1.5 會以紅底提示，代表負荷增加較快。</div>
            <div class="howtoShot" data-howto-shot-key="metrics">
              <div class="howtoShot__frame">
                <img class="howtoShot__img" alt="單調度與 ACWR 截圖" data-static-src="./assets/howto/step-6.png" />
                <div class="howtoShot__placeholder">截圖：單調度與 ACWR</div>
              </div>
            </div>
          </div>

          <div class="chartCard howtoStep" aria-label="編輯 Day 卡片">
            <div class="chartCard__title">7. 編輯 Day 卡片內容</div>
            <div class="muted">在「每週詳情」區可以：調整當日訓練數量、分鐘/強度、備註，並可拖曳左側把手重新排序。你手動修改後，系統不會自動覆寫，除非再次按自動填充。</div>
            <div class="howtoShot" data-howto-shot-key="dayCards">
              <div class="howtoShot__frame">
                <img class="howtoShot__img" alt="Day 卡片截圖" data-static-src="./assets/howto/step-7.png" />
                <div class="howtoShot__placeholder">截圖：Day 卡片</div>
              </div>
            </div>
          </div>

          <div class="chartCard howtoStep" aria-label="匯出 PDF">
            <div class="chartCard__title">8. 匯出 PDF</div>
            <div class="muted">按「匯出 PDF」可輸出表格與圖表作打印/分享（建議先設定好比賽、訓練量與 Day 卡片）。</div>
            <div class="howtoShot" data-howto-shot-key="exportPdf">
              <div class="howtoShot__frame">
                <img class="howtoShot__img" alt="匯出 PDF 截圖" data-static-src="./assets/howto/step-8.png" />
                <div class="howtoShot__placeholder">截圖：匯出 PDF</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-pace" class="tabPanel" aria-label="配速計算機">
        <div class="paceIntro">
          <div class="calendarSummary" aria-label="配速計算機說明">
            <div class="paceIntro__title">配速計算機</div>
            <div class="muted">輸入測試成績後，系統會推算配速區間與推測完賽時間（VDOT 模型）</div>
          </div>
        </div>

        <div class="paceGrid" aria-label="配速計算機內容">
          <div class="chartCard" aria-label="輸入測試成績">
            <div class="chartCard__title">輸入測試成績</div>
            <div class="paceForm">
              <label class="paceField">
                <span class="muted">測試距離</span>
                <select id="paceTestDistance" class="input" aria-label="測試距離"></select>
              </label>
              <div class="paceField">
                <span class="muted">時間（時:分:秒）</span>
                <div class="paceTimeGrid" aria-label="測試時間">
                  <input id="paceTestHours" class="input paceTimeInput" type="number" inputmode="numeric" min="0" placeholder="時" aria-label="小時" />
                  <input id="paceTestMinutes" class="input paceTimeInput" type="number" inputmode="numeric" min="0" max="59" placeholder="分" aria-label="分鐘" />
                  <input id="paceTestSeconds" class="input paceTimeInput" type="number" inputmode="numeric" min="0" max="59" placeholder="秒" aria-label="秒" />
                </div>
              </div>
              <div class="paceActions">
                <button id="paceCalcBtn" class="btn btn--primary" type="button">計算</button>
                <button id="paceResetBtn" class="btn" type="button">重設</button>
              </div>
              <div id="paceMeta" class="muted" aria-label="測試結果摘要"></div>
            </div>
          </div>

          <div class="chartCard" aria-label="配速區間">
            <div class="chartCard__title">配速區間</div>
            <div id="paceZones" class="paceTable" aria-label="配速區間表"></div>
          </div>

          <div class="chartCard" aria-label="推測完賽時間">
            <div class="chartCard__title">推測完賽時間</div>
            <div id="pacePredictions" class="paceTable" aria-label="推測完賽時間表"></div>
          </div>
        </div>
      </section>
    </main>

    <script>
      globalThis.__SUPABASE__ = {
        url: "https://yonmaiyxjewsdnyvkzvm.supabase.co",
        anonKey: "sb_publishable_JjjPDuMbjhS6NsOiNWn9YQ_5VrjOFqN",
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="./app.js"></script>
  </body>
</html>
